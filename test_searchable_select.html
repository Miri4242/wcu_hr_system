<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Searchable Select</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Searchable Select Styles */
        .searchable-select-wrapper {
            position: relative;
        }

        .searchable-input {
            cursor: pointer;
        }

        .searchable-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .searchable-dropdown .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
            transition: all 0.2s ease;
        }

        .searchable-dropdown .dropdown-item:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(236, 72, 153, 0.05) 100%);
            color: #8B5CF6;
        }

        .searchable-dropdown .dropdown-item.selected {
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            color: white;
        }

        .searchable-dropdown .dropdown-item.disabled {
            color: #6c757d;
            cursor: not-allowed;
            font-style: italic;
        }

        .searchable-dropdown .dropdown-item.disabled:hover {
            background: transparent;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-6">
                <h3>Searchable Employee Select</h3>
                <form>
                    <div class="mb-3">
                        <label for="person_key" class="form-label">Select Employee</label>
                        <select id="person_key" name="person_key" class="form-select">
                            <option value="">All Employees</option>
                            <option value="afərinabbasova">Afərin Abbasova</option>
                            <option value="ramiləabuzərova">Ramilə Abuzərova</option>
                            <option value="iradəadıgözəlova">İradə Adıgözəlova</option>
                            <option value="seyidbürhanağalarov">SeyidBürhan Ağalarov</option>
                            <option value="gülsaraağayeva">Gülsara Ağayeva</option>
                            <option value="ibrahimaliyev">İbrahim Aliyev</option>
                            <option value="fatimamammadova">Fatima Mammadova</option>
                            <option value="nizamhüseynov">Nizam Hüseynov</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            initializeSearchableSelect();
        });

        function initializeSearchableSelect() {
            const selectElement = document.getElementById('person_key');
            if (!selectElement) return;

            // Create a custom searchable select
            const wrapper = document.createElement('div');
            wrapper.className = 'searchable-select-wrapper position-relative';
            
            // Create search input
            const searchInput = document.createElement('input');
            searchInput.type = 'text';
            searchInput.className = 'form-control searchable-input';
            searchInput.placeholder = 'Type to search employees...';
            searchInput.autocomplete = 'off';
            
            // Create dropdown
            const dropdown = document.createElement('div');
            dropdown.className = 'searchable-dropdown';
            dropdown.style.display = 'none';
            
            // Hide original select
            selectElement.style.display = 'none';
            
            // Insert wrapper after select
            selectElement.parentNode.insertBefore(wrapper, selectElement.nextSibling);
            wrapper.appendChild(searchInput);
            wrapper.appendChild(dropdown);
            
            // Get all options
            const options = Array.from(selectElement.options);
            let filteredOptions = [...options];
            
            // Set initial value
            const selectedOption = options.find(opt => opt.selected);
            if (selectedOption && selectedOption.value) {
                searchInput.value = selectedOption.text;
            }
            
            // Search functionality
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                if (searchTerm === '') {
                    filteredOptions = [...options];
                } else {
                    filteredOptions = options.filter(option => 
                        option.text.toLowerCase().includes(searchTerm)
                    );
                }
                
                updateDropdown();
                showDropdown();
            });
            
            // Focus event
            searchInput.addEventListener('focus', function() {
                updateDropdown();
                showDropdown();
            });
            
            // Click outside to close
            document.addEventListener('click', function(e) {
                if (!wrapper.contains(e.target)) {
                    hideDropdown();
                }
            });
            
            function updateDropdown() {
                dropdown.innerHTML = '';
                
                filteredOptions.forEach(option => {
                    const item = document.createElement('div');
                    item.className = 'dropdown-item';
                    item.textContent = option.text;
                    item.dataset.value = option.value;
                    
                    if (option.selected) {
                        item.classList.add('selected');
                    }
                    
                    item.addEventListener('click', function() {
                        // Update select
                        selectElement.value = this.dataset.value;
                        
                        // Update input
                        searchInput.value = this.textContent;
                        
                        // Update selected state
                        options.forEach(opt => opt.selected = false);
                        const selectedOpt = options.find(opt => opt.value === this.dataset.value);
                        if (selectedOpt) selectedOpt.selected = true;
                        
                        hideDropdown();
                        
                        console.log('Selected:', this.dataset.value, this.textContent);
                    });
                    
                    dropdown.appendChild(item);
                });
                
                if (filteredOptions.length === 0) {
                    const noResults = document.createElement('div');
                    noResults.className = 'dropdown-item disabled';
                    noResults.textContent = 'No employees found';
                    dropdown.appendChild(noResults);
                }
            }
            
            function showDropdown() {
                dropdown.style.display = 'block';
            }
            
            function hideDropdown() {
                dropdown.style.display = 'none';
            }
        }
    </script>
</body>
</html>